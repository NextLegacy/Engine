# -------------------------------------------------------------------------------------------------
# This CmakeLists.txt file got generated by the TeaPot Engine.
# 
# TeaPot does not only generate the necessary build files for your project, it also
# builds the final executable for you. Therefor, its not recommended to build the project manually
# using cmake or something similar.
#
# In the process of building the executable, TeaPot will first build a shared library that
# contains all the source files of your project. 
#
# From there on, TeaPot will load the shared library and retrieve all the necessary information
# trough the reflection system that is implemented in the BoilingHotWater library.
#
# That way, can generate the necessary source code (later found in /genereated) that
# contains all the boilerplate code that is needed to run your project.
# -------------------------------------------------------------------------------------------------

# -------------------------------------------------------------------------------------------------
# Variables
# -------------------------------------------------------------------------------------------------

set(OUTPUT_DIR   ${{CMAKE_CURRENT_SOURCE_DIR}}/../../{})
set(ENGINE_DIR   {})
set(SOURCE_DIR   ${{CMAKE_CURRENT_SOURCE_DIR}}/../../{})
set(RESOURCE_DIR ${{CMAKE_CURRENT_SOURCE_DIR}}/../../{})

# -------------------------------------------------------------------------------------------------
# Some general settings
# -------------------------------------------------------------------------------------------------

cmake_minimum_required(VERSION 3.28.1)

project({} VERSION 0.0.1 LANGUAGES CXX)

set(CMAKE_CXX_STANDARD          23 )
set(CMAKE_CXX_STANDARD_REQUIRED ON )
set(CMAKE_CXX_EXTENSIONS        OFF)

# -------------------------------------------------------------------------------------------------
# Include all the necessary packages
# -------------------------------------------------------------------------------------------------

list(APPEND CMAKE_PREFIX_PATH ${{ENGINE_DIR}}/install)

find_package(BoilingHotWater REQUIRED)
find_package(OpenGL          REQUIRED)
find_package(glfw3           REQUIRED)
find_package(TeaCup          REQUIRED)
find_package(Tea             REQUIRED)

# -------------------------------------------------------------------------------------------------
# Build the shared library that contains all the source files of your project
# -------------------------------------------------------------------------------------------------

set(BUILD_SHARED_LIBS ON)

file(GLOB_RECURSE NATIVE_SOURCE_FILES ${{SOURCE_DIR}}/*.cpp ${{SOURCE_DIR}}/*.hpp)

add_library(NativeScripts SHARED ${{NATIVE_SOURCE_FILES}} EntryPoint_NativeScriptCore.cpp)

target_link_libraries(NativeScripts PUBLIC BoilingHotWater::BoilingHotWater Tea::Tea)

set_target_properties(NativeScripts PROPERTIES 
    RUNTIME_OUTPUT_DIRECTORY ${{OUTPUT_DIR}}
    RUNTIME_OUTPUT_DIRECTORY_DEBUG ${{OUTPUT_DIR}}
    RUNTIME_OUTPUT_DIRECTORY_RELEASE ${{OUTPUT_DIR}}
)

# -------------------------------------------------------------------------------------------------
# Install the shared library to the bin folder
# -------------------------------------------------------------------------------------------------

set(CMAKE_INSTALL_PREFIX ${{CMAKE_CURRENT_SOURCE_DIR}}/bin)

set(CMAKE_WINDOWS_EXPORT_ALL_SYMBOLS ON)

#install(TARGETS NativeScripts RUNTIME DESTINATION .)

# -------------------------------------------------------------------------------------------------
# Build the executable
# -------------------------------------------------------------------------------------------------

set(BUILD_SHARED_LIBS OFF)

file(GLOB_RECURSE GENERATED_SOURCE_FILES ${{CMAKE_CURRENT_SOURCE_DIR}}/*.cpp ${{CMAKE_CURRENT_SOURCE_DIR}}/*.hpp ${{NATIVE_SOURCE_FILES}})

add_executable(${{PROJECT_NAME}} ${{GENERATED_SOURCE_FILES}})

target_link_libraries(${{PROJECT_NAME}} PUBLIC NativeScripts)

set_target_properties(${{PROJECT_NAME}} PROPERTIES 
    RUNTIME_OUTPUT_DIRECTORY ${{OUTPUT_DIR}}
    RUNTIME_OUTPUT_DIRECTORY_DEBUG ${{OUTPUT_DIR}}
    RUNTIME_OUTPUT_DIRECTORY_RELEASE ${{OUTPUT_DIR}}
)

#install(TARGETS ${{PROJECT_NAME}} RUNTIME DESTINATION .)

# -------------------------------------------------------------------------------------------------
# Copy the necessary files to the bin folder
# -------------------------------------------------------------------------------------------------

add_custom_command(
        TARGET ${{PROJECT_NAME}} POST_BUILD
        COMMAND ${{CMAKE_COMMAND}} -E copy_directory
        %{{RESOURCE_DIR}} ${{CMAKE_INSTALL_PREFIX}}/Resources
        COMMENT "Copying ProjectTemplateFiles to ${{OUTPUT_DIR}}/ProjectTemplateFiles"
)